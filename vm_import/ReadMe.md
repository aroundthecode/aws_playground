procedure main page: https://docs.aws.amazon.com/vm-import/latest/userguide/vmimport-image-import.html

compatible OS list: https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html#vmimport-operating-systems

permission configuration: https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html#iam-permissions-image

image presign: https://docs.aws.amazon.com/cli/latest/reference/s3/presign.html

AMI cleanup: https://serverfault.com/questions/436648/how-to-delete-ec2-ami


Role/Policy and S3 bucket creation are managed with this terrarofm project, you just have to:
* prepare OVA file of your VM
* upload it to S3 bucket generated by terraform
* presign uploaded file
* invoke VM import
* delete OVA from bucket

Cleaning up:
* unregister AMI
* delete AMI snapshot
* terraform destroy (desltry bucket and role/policy) 

# role creation for vmimport (done once, included in terraform)

```
aws iam create-role --role-name vmimport --assume-role-policy-document "file://$(pwd)/trust-policy.json"

aws iam put-role-policy --role-name vmimport --policy-name vmimport --policy-document "file://$(pwd)/role-policy.json"
```

# s3 image presign

```
aws s3 presign s3://playground-import/aws.ova
```


# import VM

Importing image from s3 bucket

```
aws ec2 import-image --description "Fl Import test" --disk-containers "file://$(pwd)/containers.json"
```

Checking progress (ami ID taken from previous response)

```
aws ec2 describe-import-image-tasks --import-task-ids import-ami-1234567890abcdef0
```

